{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\gameScene.js"],"names":["componentSuper","require","ROW","LINE","ITEM_SIZE","SPRITE_NUM","INIT_TAGER_SCORE","getRandomInt","min","max","Math","floor","random","getRandomArbitrary","cc","Class","extends","properties","colorSprite1","SpriteFrame","colorSprite2","colorSprite3","colorSprite4","colorSprite5","Bomb","AudioClip","shopNode","Prefab","boomSpriteArray","default","type","initData","itemNode","getNodeByName","isCanTouch","touchSpriteNum","propCount","sys","localStorage","getItem","parseInt","maxScore","initGameData","score","bScore","level","tagerScore","getTagerScore","thisScore","string","levelText","tagerScoreText","onLoad","console","log","size","director","getWinSize","scaleX","width","dataMgr","bg","registerButtonTouchEvent","node","registerTouchEvent","winNode","active","failNode","getComponent","Label","thisScoreNode","maxScoreText","sendItem","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","addPropCallback","setItem","propNumText","event","keyCode","KEY","back","end","buttonTouchEvent","button","trage","name","continueGame","restartGame","itemList","touchItemList","maxTime","i","lineList","lineTime","j","num","sprite","newSpriteByNum","posX","posY","x","y","pos","p","time","delayTime","moveTo","runAction","sequence","delTime","callFunc","bind","Node","parent","addComponent","Sprite","spriteFrame","removeItemByNum","length","line","row","setTouchState","propTextAction","newBoomAnimation","isBool","animation","Animation","clip","AnimationClip","createWithSpriteFrames","addClip","animState","play","wrapMode","WrapMode","Loop","repeatCount","destroy","resetItemPos","isRemoveOne","sort","a","b","aniNode","splice","count","addScore","audioEngine","itemTwinkle","item","fadeOut","fadeIn","levelEnd","getTouchItemList","touchState","clearItemState","isCanRemoveItem","touchBegan","getLocation","update","dt","color","Color","GREEN","WHITE"],"mappings":"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","file":"gameScene.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["var componentSuper = require(\"componentSuper\")\r\nrequire(\"dataMgr\")\r\nvar ROW = 10;\r\nvar LINE = 10;\r\nvar ITEM_SIZE = 66;     \r\nvar SPRITE_NUM = 4;     //种类数量(0-SPRITE_NUM)\r\nvar INIT_TAGER_SCORE = 1000; //初始目标分数\r\n//获得随机整数\r\nvar getRandomInt = function(min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n//获得随机数(包括小数)\r\nvar getRandomArbitrary = function(min, max){\r\n    return Math.random() * (max - min) + min;\r\n}\r\n\r\ncc.Class({\r\n    extends: componentSuper,\r\n\r\n    properties: {\r\n        colorSprite1:cc.SpriteFrame,\r\n        colorSprite2:cc.SpriteFrame,\r\n        colorSprite3:cc.SpriteFrame,\r\n        colorSprite4:cc.SpriteFrame,\r\n        colorSprite5:cc.SpriteFrame,\r\n\r\n        Bomb:cc.AudioClip,\r\n\r\n        shopNode:cc.Prefab,            \r\n\r\n        boomSpriteArray: {\r\n            default: [],\r\n            type: cc.SpriteFrame\r\n        },\r\n    },\r\n    initData:function(){\r\n        this.itemNode = this.getNodeByName(\"itemNode\");\r\n        //是否允许点击\r\n        this.isCanTouch = false;\r\n        //当前点击的sprite的num\r\n        this.touchSpriteNum = false;\r\n        //道具数量\r\n        var propCount = cc.sys.localStorage.getItem(\"propCount\");//从本地储存数据中那对应的值\r\n        if (typeof(propCount) == \"string\"){\r\n            propCount = parseInt(propCount);\r\n        }else{\r\n            propCount = 5\r\n        }\r\n        this.propCount = propCount;\r\n        //最高分\r\n        var maxScore = cc.sys.localStorage.getItem(\"maxScore\");\r\n        if (typeof(maxScore) == \"string\"){\r\n            maxScore = parseInt(maxScore);\r\n        }else{\r\n            maxScore = 0;\r\n        }\r\n        this.maxScore = maxScore;\r\n    },\r\n    initGameData:function(){\r\n        //当前分数\r\n        this.score = 0;\r\n        this.bScore = 0;\r\n        //当前关卡\r\n        this.level = 1;\r\n        //目标分数\r\n        this.tagerScore = 0;\r\n        this.tagerScore = this.getTagerScore();\r\n\r\n        this.thisScore.string = this.score;\r\n        this.levelText.string = this.level;\r\n        this.tagerScoreText.string = this.tagerScore;\r\n    },\r\n    getTagerScore:function(){\r\n        var score = INIT_TAGER_SCORE + (this.level-1)*200\r\n        score = Math.min(score,3000);\r\n        score = this.tagerScore + score;\r\n        return score;\r\n    },\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        console.log(\"aaaaa >>>>>>>>>>>> \");\r\n        //适配处理,通过 缩放来调整适配。\r\n        var size = cc.director.getWinSize();//获取视图大小\r\n        //console.log(\"size ... \",size)\r\n        var scaleX = size.width/660;\r\n        dataMgr.scaleX = scaleX;\r\n        var bg = this.getNodeByName(\"bg\");\r\n        this.bg = bg\r\n        bg.scaleX = scaleX;\r\n\r\n        //注册所有按钮点击事件\r\n        this.registerButtonTouchEvent(this.node);\r\n        //注册触摸事件\r\n        this.registerTouchEvent();\r\n\r\n        //\r\n        this.initData();\r\n        //胜利节点\r\n        this.winNode = this.getNodeByName(\"winNode\");\r\n        this.winNode.active = false;\r\n        //失败节点\r\n        this.failNode = this.getNodeByName(\"failNode\");\r\n        this.failNode.active = false;\r\n        //关卡\r\n        this.levelText = this.getNodeByName(\"textLevel\").getComponent(cc.Label);\r\n        //目标分数\r\n        this.tagerScoreText = this.getNodeByName(\"tagerScore\").getComponent(cc.Label)\r\n        //当前分数\r\n        this.thisScoreNode = this.getNodeByName(\"thisScore\");\r\n        this.thisScore = this.getNodeByName(\"thisScore\").getComponent(cc.Label);\r\n        //最高分数\r\n        this.maxScoreText = this.getNodeByName(\"textScore\").getComponent(cc.Label);\r\n        this.maxScoreText.string = this.maxScore;\r\n        //初始化游戏数据\r\n        this.initGameData();\r\n        this.sendItem();\r\n\r\n        //物理返回键监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n    },\r\n    addPropCallback:function(){\r\n        this.propCount = this.propCount + 1;\r\n        cc.sys.localStorage.setItem(\"propCount\",this.propCount);\r\n        this.propNumText.string = this.propCount;\r\n    },\r\n    onKeyDown:function(event){\r\n        switch(event.keyCode) {\r\n            case cc.KEY.back:\r\n                //jsb.reflection.callStaticMethod(\"org/cocos2dx/javascript/AppActivity\", \"onKeyDown\",\"()V\");\r\n                cc.director.end();\r\n                break;\r\n        }\r\n    },\r\n    //所有按钮点击回调\r\n    buttonTouchEvent: function (event) {\r\n        //这里的 event 是一个 EventCustom 对象，你可以通过 event.detail 获取 Button 组件\r\n        var button = event.trage;\r\n        var name = button.node.name;\r\n        if (name === \"button_continue\"){ //继续游戏\r\n            this.continueGame();\r\n        }else if (name === \"button_restart\"){ //重新开始\r\n            this.restartGame();\r\n        }\r\n    },\r\n    //继续游戏\r\n    continueGame:function(){\r\n        this.winNode.active =false;\r\n        this.level += 1;\r\n        this.tagerScore = this.getTagerScore();\r\n        this.levelText.string = this.level;\r\n        this.tagerScoreText.string = this.tagerScore;\r\n\r\n        this.sendItem();\r\n    },\r\n    //重新开始\r\n    restartGame:function(){\r\n        this.failNode.active = false;\r\n        this.initGameData();\r\n        this.sendItem();\r\n    },\r\n\r\n    sendItem:function(){\r\n        this.itemList = [];\r\n        this.touchItemList = [];\r\n        var maxTime = 0\r\n        for (var i = 0 ; i < LINE ; i++){\r\n            this.itemList[i] =[];\r\n            var lineList = this.itemList[i] \r\n            var lineTime = getRandomArbitrary(0,0.4)\r\n            for (var j = 0 ; j < ROW ; j++){\r\n                var num = getRandomInt(0,SPRITE_NUM);\r\n                var sprite = this.newSpriteByNum(num+1);\r\n                lineList[j] = sprite;\r\n\r\n                var posX = ITEM_SIZE*0.5 +i*ITEM_SIZE;\r\n                var posY = ITEM_SIZE*0.5 +j*ITEM_SIZE;\r\n                sprite.x = posX;\r\n                sprite.y = posY + ROW*ITEM_SIZE;\r\n\r\n                sprite.num = num;\r\n                sprite.pos = cc.p(posX,posY);     \r\n\r\n                var time = lineTime+j/ROW;\r\n                var delayTime = cc.delayTime(time);\r\n                var moveTo = cc.moveTo(0.5,cc.p(posX,posY));\r\n                sprite.runAction(cc.sequence(delayTime,moveTo));\r\n\r\n                if (time > maxTime){\r\n                    maxTime = time;\r\n                }\r\n                if (j === ROW-1 && i === LINE-1){\r\n                    var delTime = cc.delayTime(maxTime+0.5);\r\n                    var callFunc = cc.callFunc(function(){\r\n                        this.isCanTouch = true;\r\n                    }.bind(this))\r\n                    this.node.runAction(cc.sequence(delTime,callFunc))\r\n                }           \r\n            };\r\n        };\r\n    },\r\n\r\n    newSpriteByNum:function(num){\r\n        var node = new cc.Node();\r\n        node.parent = this.itemNode;\r\n        var sprite = node.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = this[\"colorSprite\"+num];\r\n\r\n        return node;\r\n    },\r\n    removeItemByNum:function(num){\r\n        for (var i = 0 ; i < this.itemList.length ; i++){\r\n            for (var j = 0 ; j < this.itemList[i].length; j++){\r\n                if (this.itemList[i][j].num === num){\r\n                    this.touchItemList[this.touchItemList.length] = {line:i,row:j}\r\n                }\r\n            }\r\n        }\r\n        if (this.touchItemList.length > 0 ){\r\n            this.isCanTouch = false;\r\n            this.setTouchState(true);\r\n            this.propTextAction();\r\n        }        \r\n    },\r\n    newBoomAnimation:function(isBool){\r\n        var node = new cc.Node();\r\n        node.parent = this.itemNode;\r\n        node.addComponent(cc.Sprite);\r\n        var animation = node.addComponent(cc.Animation);\r\n        var clip = cc.AnimationClip.createWithSpriteFrames(this.boomSpriteArray,25); //创建一个动画\r\n        clip.name = \"boom\";      //设置动画名字\r\n        animation.addClip(clip);\r\n        var animState = animation.play(clip.name);\r\n        animState.wrapMode = cc.WrapMode.Loop;   //播放模式\r\n        animState.repeatCount = 1;    //循环次数\r\n        //注册动画完成事件回调\r\n        animation.on('finished',function(){\r\n            node.destroy();\r\n            if (isBool){\r\n                this.resetItemPos();\r\n            }\r\n        }.bind(this));\r\n\r\n        return node;\r\n    },\r\n    setTouchState:function(isRemoveOne){\r\n        if (this.touchItemList.length > 1 || isRemoveOne ){\r\n            //cc.log(\">>>>>>>>>有消除\")\r\n            this.touchItemList.sort(function(a,b){\r\n                return b.row - a.row;\r\n            })\r\n            for (var i = 0 ; i < this.touchItemList.length ; i++){\r\n                var line = this.touchItemList[i].line;\r\n                var row = this.touchItemList[i].row;\r\n                var aniNode = this.newBoomAnimation(i === this.touchItemList.length-1);\r\n                aniNode.x = this.itemList[line][row].x;\r\n                aniNode.y = this.itemList[line][row].y+10;\r\n                this.itemList[line][row].destroy();\r\n                this.itemList[line].splice(row,1);\r\n            }\r\n            for (var i = this.itemList.length-1 ; i >= 0 ; i--){\r\n                if (this.itemList[i].length <= 0){\r\n                    this.itemList.splice(i,1);\r\n                }\r\n            }\r\n            var count = this.touchItemList.length;\r\n            var addScore = count*count*5;\r\n            this.score = this.score + addScore;\r\n            //this.resetItemPos();\r\n\r\n            //播放音效\r\n            cc.audioEngine.play(this.Bomb,false,1);\r\n        }else{\r\n            this.isCanTouch = true;\r\n        }\r\n        this.touchItemList = [];    \r\n    },\r\n    //闪烁动画\r\n    itemTwinkle:function(item,count){\r\n        var fadeOut = cc.fadeOut(0.2);\r\n        var fadeIn = cc.fadeIn(0.2);\r\n        var callFunc = cc.callFunc(function(){\r\n            if (count > 0 ){\r\n                this.itemTwinkle(item,count-1)\r\n            }else{\r\n                var aniNode = this.newBoomAnimation()\r\n                aniNode.x = item.x;\r\n                aniNode.y = item.y+10;\r\n                item.destroy();\r\n            }\r\n        }.bind(this))\r\n        item.runAction(cc.sequence(fadeOut,fadeIn,callFunc))\r\n    },\r\n    //当前关卡结束\r\n    levelEnd:function(){\r\n        var count = 0;\r\n        for (var i = 0 ; i < this.itemList.length ; i++){\r\n            for (var j = 0 ; j < this.itemList[i].length; j++){\r\n                count += 1;\r\n                this.itemTwinkle(this.itemList[i][j],2)\r\n            }\r\n        }\r\n\r\n        var delayTime = cc.delayTime(1)\r\n        var callFunc = cc.callFunc(function(){\r\n            if (count <= 10){\r\n                var addScore = (10 - count + 1)*100;\r\n                this.score = this.score + addScore;\r\n            }\r\n            if (this.score >= this.tagerScore){\r\n                this.winNode.active =true;\r\n            }else{\r\n                this.failNode.active = true;\r\n            }\r\n        }.bind(this))\r\n        this.node.runAction(cc.sequence(delayTime,callFunc))\r\n    },\r\n    getTouchItemList:function(line,row){       \r\n        if (this.itemList[line] && this.itemList[line][row] && this.itemList[line][row].num === this.touchSpriteNum){\r\n            this.itemList[line][row].touchState = true;\r\n            this.touchItemList[this.touchItemList.length] = {line:line,row:row};\r\n            //往右边递归\r\n            if (this.itemList[line+1] && this.itemList[line+1][row] && !this.itemList[line+1][row].touchState && this.itemList[line+1][row].num === this.touchSpriteNum){\r\n                this.getTouchItemList(line+1,row)\r\n            }\r\n            //往左边递归\r\n            if (this.itemList[line-1] && this.itemList[line-1][row] && !this.itemList[line-1][row].touchState && this.itemList[line-1][row].num === this.touchSpriteNum){\r\n                this.getTouchItemList(line-1,row)\r\n            }\r\n            //往上边递归\r\n            if (this.itemList[line][row+1] && !this.itemList[line][row+1].touchState && this.itemList[line][row+1].num === this.touchSpriteNum){\r\n                this.getTouchItemList(line,row+1)\r\n            }\r\n            //往下边递归\r\n            if (this.itemList[line][row-1] && !this.itemList[line][row-1].touchState && this.itemList[line][row-1].num === this.touchSpriteNum){\r\n                this.getTouchItemList(line,row-1)\r\n            }\r\n        }\r\n    },\r\n    //清空当前item状态\r\n    clearItemState:function(){\r\n        this.touchItemList = [];\r\n        for (var i = 0 ; i < this.itemList.length ; i++){\r\n            for (var j = 0 ; j < this.itemList[i].length; j++){\r\n                this.itemList[i][j].touchState =false;\r\n            }\r\n        }\r\n    },\r\n     //判断是否还有东西可以移除\r\n    isCanRemoveItem:function(){\r\n        for (var i = 0 ; i < this.itemList.length ; i++){\r\n            for (var j = 0 ; j < this.itemList[i].length; j++){\r\n                this.touchSpriteNum = this.itemList[i][j].num\r\n                this.getTouchItemList(i,j);\r\n                if (this.touchItemList.length >= 2){\r\n                    this.clearItemState();\r\n                    return true;\r\n                }\r\n                this.clearItemState();\r\n            }\r\n        }\r\n        this.clearItemState();\r\n        return false;\r\n    },\r\n    resetItemPos:function(){\r\n        for (var i = 0 ; i < this.itemList.length ; i++){\r\n            for (var j = 0 ; j < this.itemList[i].length; j++){\r\n                this.itemList[i][j].touchState =false;\r\n\r\n                var posX = ITEM_SIZE*0.5 +i*ITEM_SIZE;\r\n                var posY = ITEM_SIZE*0.5 +j*ITEM_SIZE;\r\n\r\n                var moveTo = cc.moveTo(0.2,cc.p(posX,posY));\r\n                this.itemList[i][j].runAction(moveTo);\r\n            }\r\n        }\r\n        var delayTime = cc.delayTime(0.3)\r\n        var callFunc = cc.callFunc(function(){\r\n            if (this.isCanRemoveItem()){\r\n                this.isCanTouch = true;\r\n            }else{\r\n                this.levelEnd()\r\n            }\r\n        }.bind(this))\r\n        this.node.runAction(cc.sequence(delayTime,callFunc))\r\n    },\r\n\r\n    touchBegan:function(event){\r\n        var pos = event.getLocation();\r\n        var line = Math.floor((pos.x)/(ITEM_SIZE*dataMgr.scaleX));\r\n        var row = Math.floor(pos.y/ITEM_SIZE);\r\n        //cc.log(\">>>>>>>>>>>this.isCanTouch\",this.isCanTouch)\r\n        if (this.isCanTouch && this.itemList[line] && this.itemList[line][row]){\r\n            //cc.log(\">>>>>>>>>>>>>line,row\",line,row)\r\n            this.isCanTouch = false;\r\n            this.touchSpriteNum = this.itemList[line][row].num;\r\n            this.getTouchItemList(line,row);\r\n            this.setTouchState();\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update:function (dt) {\r\n        //分数增加处理\r\n        if (this.bScore < this.score){\r\n            this.bScore += 5;\r\n            this.thisScore.string = this.bScore;\r\n        }\r\n        //当前分数颜色处理\r\n        if (this.score >= this.tagerScore){\r\n            this.thisScoreNode.color = cc.Color.GREEN;\r\n        }else{\r\n             this.thisScoreNode.color = cc.Color.WHITE;\r\n        }\r\n        //最高分处理\r\n        if (this.score > this.maxScore){\r\n            this.maxScore = this.score;\r\n            this.maxScoreText.string = this.maxScore;\r\n            cc.sys.localStorage.setItem(\"maxScore\",this.maxScore);\r\n        }\r\n    },\r\n});\r\n"]}